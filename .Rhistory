4274,4290,4311,5820,6501,6504,7644,5751,440,528,4264)
as.character(
query21da_sf<-get_census(dataset='CA21',
regions= list(DA=boundaries21$DAUID),
vector=query,
level="DA",
geoformat= "sf",
use_cache = T)
query21da_sf<-get_census(dataset='CA21',
regions= list(DA=boundaries21$DAUID),
vector=query,
level="DA",
geo_format = "sf",
use_cache = T)
get_census(dataset='CA21',
regions= list(DA=boundaries21$DAUID[1:(57932/2)]),
vector=query,
level="DA",
use_cache = T,
geo_format = "sf")
query21da_sf<-get_census(dataset='CA21',
regions= list(DA=boundaries21$DAUID[1:(57932/2)]),
vector=query,
level="DA",
use_cache = T,
geo_format = "sf")
query21da_sf<-get_census(dataset='CA21',
regions= list(DA=boundaries21$DAUID[1:7]),
vector=query,
level="DA",
use_cache = T,
geo_format = "sf")
query21da_sf<-get_census(dataset='CA21',
regions= list(DA=boundaries21$DAUID[1:(57932/2)]),
vector=query,
level="DA",
use_cache = T,
geo_format = "sf")
?get_census
boundaries21$DAUID[1:(57932/2)]
gc()
query
57932/2
(57932/4)
query21da_sf<-get_census(dataset='CA21',
regions= list(DA=boundaries21$DAUID[1:(57932/4)]),
vector=query,
level="DA",
geo_format = "sf")
57932/4*3
57932/4+1
query21da_sf2<-get_census(dataset='CA21',
regions= list(DA=boundaries21$DAUID[(57932/4+1):(57932/4*3)]),
vector=query,
level="DA",
geo_format = 'sf')
boundaries21$DAUID[(57932/4+1):(57932/4*3)]
(57932/4+1):(57932/4*3)
(57932/4*3)
(57932/4+1)
14484+1483
14483+14484
(57932/4*2
)
query21da_sf2<-get_census(dataset='CA21',
regions= list(DA=boundaries21$DAUID[(57932/4+1):(57932/4*2)]),
vector=query,
level="DA",
geo_format = 'sf')
query21da_sf2<-get_census(dataset='CA21',
regions= list(DA=boundaries21$DAUID[(57932/4+1):(57932/4+4)]),#(57932/4*2)]),
vector=query,
level="DA",
geo_format = 'sf')
(57932/4*2)
query21da_sf2<-get_census(dataset='CA21',
regions= list(DA=boundaries21$DAUID[(57932/4+1):28966]),#(57932/4*2)]),
vector=query,
level="DA",
geo_format = 'sf')
28967+14483
query21da_sf3<-get_census(dataset='CA21',
regions= list(DA=boundaries21$DAUID[28967:43450]),
vector=query,
level="DA",
geo_format = 'sf')
query21da_sf3<-get_census(dataset='CA21',
regions= list(DA=boundaries21$DAUID[28967:43450]),
vector=query,
level="DA",
geo_format = 'sf')
set_cancensus_cache_path("C:\\CEDEUS\\2022\\oct03_census2021\\cache")
set_cancensus_cache_path("C:\\CEDEUS\\2022\\oct03_census2021\\cache", install=T)
query21da_sf3<-get_census(dataset='CA21',
regions= list(DA=boundaries21$DAUID[28966+1:43450]),
vector=query,
level="DA",
geo_format = 'sf')
boundaries21$DAUID[28966+1:43450
]
query21da_sf3<-get_census(dataset='CA21',
regions= list(DA=boundaries21$DAUID[(28966+1):43450]),
vector=query,
level="DA",
geo_format = 'sf')
rbind(query21da,query21da_2)
query21da<-rbind(query21da,query21da_2)
rm(query21da_2)
rm(query21da_sf,query21da_sf2)
colnames(query21da)
View(query21da)
data.frame(code=query21da,abbrvtn=nombres)
nombres<-c("TOTPOP","TOTDWELL","POPDENSITY","BELOW15","WORKAGE","SENIOR",
"ABOVE85","FEMALE","ONEPERSONHH","NOLANG","GOVTRANSFER","MEDHHINC",
"LOWINCOME","LOWINCOME1","LOWINCWORKAGE","LOWINCSENIOR",
"RECENTIMMIGRANT","FIRSTGENERATION","TOTVISMIN","SOUTHASIAN",
"CHINESE","BLACK","FILIPINO","LATINAMERICAN","ARAB","SOUTHEASTASIAN",
"WESTASIAN","KOREAN","JAPANESE","VISMIN_NIE","MULTI_VINMIN",
"NONVISMIN","FRSTNATION","METIS","INUIT","RENTER","CROWDHOME",
"REPAIRHOME","SHLTCOSTR","MEDHOMVAL","NODEGREE","UNEMPLOYED","NILF",
"PUBTRANSIT","MOVERS","APT5STORY","LONEPARENT","BUILT1960")
data.frame(code=query21da,abbrvtn=nombres)
data.frame(code=query,abbrvtn=nombres)
code_abvt<-data.frame(code=query,abbrvtn=nombres)
colnames(query21da)
library(sf)
library(cancensus)
library(tidyverse)
sub(" :.*", "", colnames(query21da))
sub(":.*", "", colnames(query21da))
sub(":.*", "", colnames(query21da))[12:59]
?order
order(code_abvt$abbrvtn)
order(code_abvt$code)
code_abvt
code_abvt$code
order(code_abvt$code,sub(":.*", "", colnames(query21da))[12:59])
order(code_abvt$code)
order(code_abvt$code,method=sub(":.*", "", colnames(query21da))[12:59])
code_abvt$code
sub(":.*", "", colnames(query21da))[12:59]
target<-sub(":.*", "", colnames(query21da))[12:59]
code_abvt[match(target,code_abvt$code),]
target
code_abvt[match(target,code_abvt$code),]
code_abvt<-code_abvt[match(target,code_abvt$code),]
cbind(code_abvt, target)
cbind(code_abvt, target) |> .
cbind(code_abvt, target)|> isTRUE( code_abvt$code,target)
cbind(code_abvt, target)|> isTRUE( code_abvt$code==target)
code_abvt$code==target
code_abvt$code==target
query21da
gc()
rm(boundaries21)
query21da
colnames(query21da)
gc()
liton_dataset<-query21da
colnames(query21da)[12:59]
colnames(liton_dataset)
colnames(liton_dataset)[12:59]
code_abvt$code
colnames(liton_dataset)[12:59]
code_abvt$code
code_abvt$abbrvtn
View(code_abvt)
View(query21da)
colnames(liton_dataset)[12:59]<-code_abvt$abbrvtn
liton_dataset
View(query21da)
View(liton_dataset)
View(query21da)
unique(query21da$CMA_UID)
View(query21da)
query21da$CD_UID
unique(query21da$CD_UID)
unique(query21da$CMA_UID)
41+111
boundaries21cma<-st_read("C:\\CEDEUS\\2022\\oct03_census2021\\input\\boundaries_21CMA&CA\\lcma000b21a_e\\lcma000b21a_e.shp")
41+111
View(boundaries21cma)
View(boundaries21cma)
unique(boundaries21cma)
unique(boundaries21cma$CMAUID)
View(boundaries21cma)
library(sf)
library(cancensus)
library(tidyverse)
options(cancensus.api_key = "CensusMapper_ec721325d8f0b73622eb6a175f8de05a")
set_cancensus_cache_path("C:\\CEDEUS\\2022\\oct03_census2021\\cache")
query21da_cma<-get_census(dataset='CA21',
regions= list(CMA=boundaries21cma$CMAUID),
vector=query,
level="CMA",
use_cache = T)
query21cma<-get_census(dataset='CA21',
regions= list(CMA=boundaries21cma$CMAUID),
vector=query,
level="CMA",
use_cache = T)
View(query21cma)
boundaries21cma$CMAUID
unique(query21da$CMA_UID)
query21da$CMA_UID)[c(1,3:153)]
query21da$CMA_UID[c(1,3:153)]
c(1,3:153)
unique(query21da$CMA_UID[c(1,3:153)]
)
unique(query21da$CMA_UID)[c(1,3:153)]
query21cma<-get_census(dataset='CA21',
regions= list(CMA=unique(query21da$CMA_UID)[c(1,3:153)]),
vector=query,
level="CMA",
use_cache = T)
View(query21cma)
rm(boundaries21cma)
unique(query21da$CSD_UID)
query21csd<-get_census(dataset='CA21',
regions= list(CSD=unique(query21da$CSD_UID)),
vector=query,
level="CSD",
use_cache = T)
query21ct<-get_census(dataset='CA21',
regions= list(CT=unique(query21da$CT_UID)),
vector=query,
level="CT",
use_cache = T)
query21cd<-get_census(dataset='CA21',
regions= list(CT=unique(query21da$CD_UID)),
vector=query,
level="CD",
use_cache = T)
query21cma
colnames(query21cd)
colnames(query21cd)[10:57]
colnames(query21cma)
colnames(query21ct)
colnames(query21ct)[12:59]
colnames(query21csd)
colnames(query21csd)[11:58]
colnames(query21csd)[last(48)]
colnames(query21csd)[tail(n=48)]
tail(colnames(query21csd),n=48)
colnames(query21csd)[end(colnames(query21csd)[48])]
end(colnames(query21csd))
colnames(query21csd)[end(colnames(query21csd))]
colnames(query21csd)
rev(colnames(query21csd))
rev(colnames(query21csd))[1:48]
end(colnames(query21csd))
mylast(colnames(query21csd))
colnames(query21csd)[length(48)]
colnames(query21csd)
colnames(query21csd)[length(1)]
colnames(query21csd)[length(3)]
colnames(query21csd)
colnames(query21csd)[length(45)]
tail(sub(":.*", "", colnames(query21csd)),n=48)
colnames(query21csd)
tail(sub(":.*", "", colnames(query21csd)),n=48)
col_format
col_format(query21cd)
col_format<-function(x){
code_abvt
target<-tail(sub(":.*", "", colnames(x)),n=48)
code_rplcmnt<-code_abvt[match(target,code_abvt$code),]
print(code_rplcmnt$code==target)
tail(colnames(x),48)<-code_abvt$abbrvtn
}
col_format(query21cd)
tail(colnames(query21csd))
colnames(query21csd)
col_format(query21cd)
colnames(query21cd)
last_col(query21cd)
query21cd
last_col(query21cd)
names(query21cd)[tail(query21cd,48)]
names(query21cd)
names(query21cd)[]
names(query21cd[-length(query21cd)])
query21cd
names(query21cd[-length(query21cd)])
View(query21cd)
length(query21cd)
?rename_at
?ncol
tail(colnames(query21csd),48)
code_abvt$abbrvtn
col_format<-function(x){
code_abvt
target<-tail(sub(":.*", "", colnames(x)),n=48)
code_rplcmnt<-code_abvt[match(target,code_abvt$code),]
print(code_rplcmnt$code==target)
rename_at(tail(colnames(x),48),code_rplcmnt$abbrvtn)
return(x)
}
col_format(query21csd)
col_format<-function(x){
code_abvt
target<-tail(sub(":.*", "", colnames(x)),n=48)
code_rplcmnt<-code_abvt[match(target,code_abvt$code),]
print(code_rplcmnt$code==target)
rename_at(vars(x,tail(colnames(x),48)),code_rplcmnt$abbrvtn)
return(x)
}
col_format(query21csd)
vars(query21ct,tail(colnames(query21ct),48))
tail(colnames(query21ct),48)
query21ct
vars(query21ct,tail(colnames(query21ct),48))
tail(colnames(query21ct),48)
?vars
query21ct %>% vars(tail(colnames(query21ct),48))
tail(colnames(query21ct)
,48)
query21ct %>% vars(v_CA21_1: Population, 2021:v_CA21_528: In a one-parent family)
rename_at(vars(query21ct,tail(colnames(query21ct),48)),code_rplcmnt$abbrvtn)
query21ct
colnames(query21ct)
vars(query21ct,GeoUID:Type)
rename_at(vars(x,tail(colnames(x),48)),code_rplcmnt$abbrvtn)
vars(query21ct,tail(colnames(query21ct),48))
target
code_abvt$code
target
code_abvt
tail(sub(":.*", "", colnames(query21cd)),n=48)
nrow(query21cd)
ncols(query21cd)
ncol(query21cd)
ncol(query21cd)-48
ncol(query21cd)-48:48
(ncol(query21cd)-48):48
ncol(query21cd)-48)
ncol(query21cd)-48
ncol(query21cd)-48):48
ncol(query21cd)-48)
ncol(query21cd)-48
ncol(query21cd)-48
col_format<-function(x){
code_abvt
target<-tail(sub(":.*", "", colnames(x)),n=48)
code_rplcmnt<-code_abvt[match(target,code_abvt$code),]
print(code_rplcmnt$code==target)
code_rplcmnt$code
a<-ncol(x)-48
b<-a+48
colnames(x)[a:b]<-code_rplcmnt$abbrvtn
x
return(x)
}
col_format(query21csd)
test<-col_format(query21csd)
View(test)
View(query21csd)
col_format<-function(x){
code_abvt
target<-tail(sub(":.*", "", colnames(x)),n=48)
code_rplcmnt<-code_abvt[match(target,code_abvt$code),]
print(code_rplcmnt$code==target)
code_rplcmnt$code
a<-ncol(x)-48
b<-a+48
colnames(x)[a+1:b]<-code_rplcmnt$abbrvtn
x
return(x)
}
test<-col_format(query21csd)
col_format<-function(x){
code_abvt
target<-tail(sub(":.*", "", colnames(x)),n=48)
code_rplcmnt<-code_abvt[match(target,code_abvt$code),]
print(code_rplcmnt$code==target)
code_rplcmnt$code
a<-ncol(x)-48
b<-a+48
colnames(x)[a+1:b+1]<-code_rplcmnt$abbrvtn
x
return(x)
}
test<-col_format(query21csd)
col_format<-function(x){
code_abvt
target<-tail(sub(":.*", "", colnames(x)),n=48)
code_rplcmnt<-code_abvt[match(target,code_abvt$code),]
print(code_rplcmnt$code==target)
code_rplcmnt$code
a<-ncol(x)-48
b<-a+48
colnames(x)[a+1:b-1]<-code_rplcmnt$abbrvtn
x
return(x)
}
test<-col_format(query21csd)
ncol(query21cd)
ncol(query21cd)-48
ncol(query21cd)-48
48+9
57-9
code_abvt
code_abvt$abbrvtn
View(code_abvt)
code_abvt<-data.frame(code=query,abbrvtn=nombres)
View(code_abvt)
col_format<-function(x){
code_abvt
target<-tail(sub(":.*", "", colnames(x)),n=48)
code_rplcmnt<-code_abvt[match(target,code_abvt$code),]
print(code_rplcmnt$code==target)
code_rplcmnt$code
a<-ncol(x)-48
b<-a+48
colnames(x)[a:b-1]<-code_rplcmnt$abbrvtn
x
return(x)
}
col_format(query21csd)
View(test)
View(query21csd)
col_format<-function(x){
code_abvt
target<-tail(sub(":.*", "", colnames(x)),n=48)
code_rplcmnt<-code_abvt[match(target,code_abvt$code),]
print(code_rplcmnt$code==target)
code_rplcmnt$code
a<-ncol(x)-48
b<-a+48
colnames(x)[a+1:b]<-code_rplcmnt$abbrvtn
x
return(x)
}
test<-col_format(query21csd)
test<-col_format(query21cd)
View(query21cd)
View(test)
query21cd
col_format(query21cd)
colnames(test)
colnames(test)[1:2]
colnames(test)[1:2]<-c("blabla","bloblo")
col_format<-function(x){
code_abvt
target<-tail(sub(":.*", "", colnames(x)),n=48)
code_rplcmnt<-code_abvt[match(target,code_abvt$code),]
print(code_rplcmnt$code==target)
code_rplcmnt$code
a<-ncol(x)-48
b<-a+48
colnames(x)[a:b]<-code_rplcmnt$abbrvtn
x
return(x)
}
test<-col_format(query21cd)
View(test)
col_format<-function(x){
code_abvt
target<-tail(sub(":.*", "", colnames(x)),n=48)
code_rplcmnt<-code_abvt[match(target,code_abvt$code),]
print(code_rplcmnt$code==target)
code_rplcmnt$code
a<-ncol(x)-48
b<-a+48
colnames(x)[a+1:b]<-code_rplcmnt$abbrvtn
x
return(x)
}
test<-col_format(query21cd)
query21cd_liton<-col_format(query21cd)
query21csd_liton<-col_format(query21csd)
query21cma_liton<-col_format(query21cma)
query21ct_liton<-col_format(query21ct)
View(query21cd)
View(query21cd_liton)
query21da_liton<-col_format(query21da)
View(query21da)
View(query21da_liton)
query21cd
write.csv(query21cd,"output/rawdata/csv/query21cd.csv")
write.csv(query21csd,"output/rawdata/csv/query21csd.csv")
write.csv(query21cma,"output/rawdata/csv/query21cma.csv")
write.csv(query21ct,"output/rawdata/csv/query21ct.csv")
write.csv(query21da,"output/rawdata/csv/query21da.csv")
writexl::write_xlsx(query21cd,"output/rawdata/xlsx/query21cd.xlsx")
writexl::write_xlsx(query21csd,"output/rawdata/xlsx/query21csd.xlsx")
writexl::write_xlsx(query21cma,"output/rawdata/xlsx/query21cma.xlsx")
writexl::write_xlsx(query21ct,"output/rawdata/xlsx/query21ct.xlsx")
writexl::write_xlsx(query21da,"output/rawdata/xlsx/query21da.xlsx")
write.csv(query21cd,"output/formated/csv/query21cd_form.csv")
write.csv(query21csd,"output/formated/csv/query21csd_form.csv")
write.csv(query21cma,"output/formated/csv/query21cma_form.csv")
write.csv(query21ct,"output/formated/csv/query21ct_form.csv")
write.csv(query21da,"output/formated/csv/query21da_form.csv")
writexl::write_xlsx(query21cd,"output/formated/xlsx/query21cd_form.xlsx")
writexl::write_xlsx(query21csd,"output/formated/xlsx/query21csd_form.xlsx")
writexl::write_xlsx(query21cma,"output/formated/xlsx/query21cma_form.xlsx")
writexl::write_xlsx(query21ct,"output/formated/xlsx/query21ct_form.xlsx")
writexl::write_xlsx(query21da,"output/formated/xlsx/query21da_form.xlsx")
library(sf)
library(cancensus)
library(tidyverse)
write.csv(query21cd_liton,"output/formated/csv/query21cd_form.csv")
write.csv(query21csd_liton,"output/formated/csv/query21csd_form.csv")
write.csv(query21cma_liton,"output/formated/csv/query21cma_form.csv")
write.csv(query21ct_liton,"output/formated/csv/query21ct_form.csv")
write.csv(query21da_liton,"output/formated/csv/query21da_form.csv")
writexl::write_xlsx(query21cd_liton,"output/formated/xlsx/query21cd_form.xlsx")
writexl::write_xlsx(query21csd_liton,"output/formated/xlsx/query21csd_form.xlsx")
writexl::write_xlsx(query21cma_liton,"output/formated/xlsx/query21cma_form.xlsx")
writexl::write_xlsx(query21ct_liton,"output/formated/xlsx/query21ct_form.xlsx")
writexl::write_xlsx(query21da_liton,"output/formated/xlsx/query21da_form.xlsx")
View(query21cd_liton)
View(query21cd)
